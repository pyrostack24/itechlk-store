'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useSession } from 'next-auth/react'\nimport AdminLayout from '@/components/AdminLayout'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Users, Mail, Calendar, Shield, Search } from 'lucide-react'\nimport Image from 'next/image'\n\ninterface Customer {\n  id: string\n  name: string | null\n  email: string\n  image: string | null\n  isAdmin: boolean\n  createdAt: string\n  _count: {\n    orders: number\n    subscriptions: number\n  }\n}\n\nexport default function CustomersPage() {\n  const router = useRouter()\n  const { data: session, status } = useSession()\n  const [customers, setCustomers] = useState<Customer[]>([])\n  const [loading, setLoading] = useState(true)\n  const [searchQuery, setSearchQuery] = useState('')\n\n  useEffect(() => {\n    if (status === 'unauthenticated') {\n      router.push('/auth/signin')\n    }\n  }, [status, router])\n\n  useEffect(() => {\n    fetchCustomers()\n  }, [])\n\n  const fetchCustomers = async () => {\n    try {\n      const response = await fetch('/api/admin/customers')\n      if (response.ok) {\n        const data = await response.json()\n        setCustomers(data.customers)\n      }\n    } catch (error) {\n      console.error('Error fetching customers:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const filteredCustomers = customers.filter(customer => \n    customer.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    customer.email.toLowerCase().includes(searchQuery.toLowerCase())\n  )\n\n  if (status === 'loading' || loading) {\n    return (\n      <AdminLayout>\n        <div className=\"flex items-center justify-center min-h-[400px]\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto\"></div>\n            <p className=\"mt-4 text-neutral-600\">Loading customers...</p>\n          </div>\n        </div>\n      </AdminLayout>\n    )\n  }\n\n  return (\n    <AdminLayout>\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div>\n          <h1 className=\"text-3xl font-bold text-neutral-900\">Customers</h1>\n          <p className=\"text-neutral-600 mt-2\">Manage and view all registered customers</p>\n        </div>\n\n        {/* Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-neutral-600\">Total Customers</p>\n                  <p className=\"text-3xl font-bold text-neutral-900 mt-1\">{customers.length}</p>\n                </div>\n                <div className=\"h-12 w-12 rounded-xl bg-primary-100 flex items-center justify-center\">\n                  <Users className=\"h-6 w-6 text-primary-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-neutral-600\">Active Subscriptions</p>\n                  <p className=\"text-3xl font-bold text-neutral-900 mt-1\">\n                    {customers.reduce((sum, c) => sum + c._count.subscriptions, 0)}\n                  </p>\n                </div>\n                <div className=\"h-12 w-12 rounded-xl bg-success-100 flex items-center justify-center\">\n                  <Calendar className=\"h-6 w-6 text-success-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-neutral-600\">Total Orders</p>\n                  <p className=\"text-3xl font-bold text-neutral-900 mt-1\">\n                    {customers.reduce((sum, c) => sum + c._count.orders, 0)}\n                  </p>\n                </div>\n                <div className=\"h-12 w-12 rounded-xl bg-secondary-100 flex items-center justify-center\">\n                  <Shield className=\"h-6 w-6 text-secondary-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search */}\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-neutral-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search customers by name or email...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Customers List */}\n        <Card>\n          <CardHeader>\n            <CardTitle>All Customers ({filteredCustomers.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {filteredCustomers.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <Users className=\"h-12 w-12 text-neutral-300 mx-auto mb-4\" />\n                  <p className=\"text-neutral-600\">No customers found</p>\n                </div>\n              ) : (\n                filteredCustomers.map((customer) => (\n                  <div\n                    key={customer.id}\n                    className=\"flex items-center justify-between p-4 border border-neutral-200 rounded-lg hover:border-primary-300 hover:bg-primary-50/50 transition-all\"\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      {customer.image ? (\n                        <Image\n                          src={customer.image}\n                          alt={customer.name || 'User'}\n                          width={48}\n                          height={48}\n                          className=\"rounded-full\"\n                        />\n                      ) : (\n                        <div className=\"h-12 w-12 rounded-full bg-gradient-to-r from-primary-600 to-secondary-600 flex items-center justify-center\">\n                          <span className=\"text-white font-semibold text-lg\">\n                            {customer.name?.charAt(0) || customer.email.charAt(0).toUpperCase()}\n                          </span>\n                        </div>\n                      )}\n                      <div>\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-semibold text-neutral-900\">{customer.name || 'No Name'}</p>\n                          {customer.isAdmin && (\n                            <Badge variant=\"primary\" className=\"text-xs\">\n                              <Shield className=\"h-3 w-3 mr-1\" />\n                              Admin\n                            </Badge>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-1 text-sm text-neutral-600 mt-1\">\n                          <Mail className=\"h-3 w-3\" />\n                          {customer.email}\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"flex items-center gap-4 text-sm\">\n                        <div>\n                          <p className=\"text-neutral-600\">Orders</p>\n                          <p className=\"font-semibold text-neutral-900\">{customer._count.orders}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-neutral-600\">Subscriptions</p>\n                          <p className=\"font-semibold text-neutral-900\">{customer._count.subscriptions}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-neutral-600\">Joined</p>\n                          <p className=\"font-semibold text-neutral-900\">\n                            {new Date(customer.createdAt).toLocaleDateString()}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </AdminLayout>\n  )\n}\n