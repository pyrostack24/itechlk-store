export const dynamic = 'force-dynamic'\nimport { NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { prisma } from '@/lib/prisma'\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions)\n\n    if (!session?.user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Check if user is admin\n    const user = await prisma.user.findUnique({\n      where: { email: session.user.email! },\n      select: { isAdmin: true },\n    })\n\n    if (!user?.isAdmin) {\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n    }\n\n    // Fetch all customers with their order and subscription counts\n    const customers = await prisma.user.findMany({\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        image: true,\n        isAdmin: true,\n        createdAt: true,\n        _count: {\n          select: {\n            orders: true,\n            subscriptions: true,\n          },\n        },\n      },\n      orderBy: {\n        createdAt: 'desc',\n      },\n    })\n\n    return NextResponse.json({ customers })\n  } catch (error) {\n    console.error('Error fetching customers:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch customers' },\n      { status: 500 }\n    )\n  }\n}\n